{% extends "base.html" %}

{% block content %}
<div class="card">
    <h1><i class="fas fa-brain"></i> Model Training</h1>

    <div class="form-group">
        <label>Select Algorithm</label>
        <select id="algorithm">
            <option value="Logistic Regression">Logistic Regression</option>
            <option value="SVM">Support Vector Machine (SVM)</option>
            <option value="Random Forest">Random Forest</option>
            <option value="XGBoost">XGBoost</option>
            <option value="Ensemble">Ensemble Voting</option>
        </select>
    </div>

    <button onclick="startTraining()">Start Training</button>

    <div id="trainingResult" style="margin-top: 20px; display: none;">
        <div class="alert" id="resultMessage">Training...</div>
        <table id="metricsTable" style="display:none;">
            <tr>
                <th>Metric</th>
                <th>Value</th>
            </tr>
            <tr>
                <td>Accuracy</td>
                <td id="acc"></td>
            </tr>
            <tr>
                <td>F1 Score</td>
                <td id="f1"></td>
            </tr>
            <tr>
                <td>Precision</td>
                <td id="prec"></td>
            </tr>
            <tr>
                <td>Recall</td>
                <td id="rec"></td>
            </tr>
        </table>
    </div>
</div>

<script>
    function startTraining() {
        const algo = document.getElementById('algorithm').value;
        const resultDiv = document.getElementById('trainingResult');
        const msg = document.getElementById('resultMessage');
        const table = document.getElementById('metricsTable');

        resultDiv.style.display = 'block';
        msg.innerText = "Training in progress... This may take a while.";
        table.style.display = 'none';

        fetch('{{ url_for("start_training") }}', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: 'algorithm=' + encodeURIComponent(algo)
        })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    msg.innerText = "Training Completed Successfully!";
                    msg.style.background = "#27ae60";
                    table.style.display = 'table';
                    document.getElementById('acc').innerText = data.metrics.accuracy.toFixed(4);
                    document.getElementById('f1').innerText = data.metrics.f1.toFixed(4);
                    document.getElementById('prec').innerText = data.metrics.precision.toFixed(4);
                    document.getElementById('rec').innerText = data.metrics.recall.toFixed(4);
                } else {
                    msg.innerText = "Error: " + data.message;
                    msg.style.background = "#c0392b";
                }
            })
            .catch(err => {
                msg.innerText = "Request Failed";
            });
    }
</script>
{% endblock %}